<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Escritor C J Benito</title>

  <style>
    :root{
      --bg:#f5f7fa; --card:#fff; --accent:#0077ff; --marine:#1e88e5;
      --text:#333; --subtle:#8a94a6; --radius:12px; --shadow:0 4px 14px rgba(0,0,0,.08);
      --font:'Segoe UI',Roboto,Helvetica,Arial,sans-serif;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{background:var(--bg);color:var(--text);font-family:var(--font);min-height:100vh;padding:2rem}
    .wrapper{max-width:420px;width:100%;margin:auto}

    nav{display:flex;gap:.5rem;margin-bottom:1.5rem}
    nav button{
      flex:1;
      padding:.8rem;
      border:none;
      border-radius:var(--radius);
      background:var(--card);
      color:var(--accent);
      font-size:1rem;
      box-shadow:var(--shadow);
      cursor:pointer;
      transition:.2s;
    }
    nav button.active,
    nav button:hover{background:var(--accent);color:#fff}

    section{display:none}
    section.active{display:block}

    h1{text-align:center;margin-bottom:1.5rem}
    form{display:flex;gap:.5rem}
    input,button{border:none;padding:.9rem 1.2rem;font-size:1rem;border-radius:var(--radius)}
    input{flex:1;background:var(--card);box-shadow:var(--shadow);outline:none}
    button{background:var(--accent);color:#fff;cursor:pointer}
    button:hover{opacity:.9}
    #cities{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:1rem;justify-content:center}
    #cities button{background:var(--card);color:var(--accent);border:1px solid var(--accent);box-shadow:var(--shadow);border-radius:var(--radius);padding:.4rem .8rem;cursor:pointer}
    #result{margin-top:1.5rem}
    .weather-card,.marine-card{background:var(--card);border-radius:var(--radius);padding:1.5rem;box-shadow:var(--shadow);margin-bottom:1rem}
    .marine-card{border-left:4px solid var(--marine)}
    .marine-card h3{color:var(--marine);display:flex;align-items:center;gap:.5rem}
    .marine-card h3::before{content:"ðŸŒŠ";font-size:1.2em}
    .marine-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-top:.5rem}
    .marine-item{background:rgba(30,136,229,.05);padding:.8rem;border-radius:8px;text-align:center}
    .marine-item strong{color:var(--marine);display:block;font-size:1.1em}
    .wave-height{font-size:1.5em;color:var(--marine);font-weight:bold}

    .gas-iframe{
      width:100%;
      min-height:70vh;
      border:none;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <nav>
      <button class="nav-btn active" data-section="clima">Clima</button>
      <button class="nav-btn" data-section="gas">Gasolineras</button>
    </nav>

    <section id="clima" class="active">
      <h1>Escritor C J Benito</h1>
      <form id="weatherForm">
        <input id="city" type="text" placeholder="Ej. Valencia, Barcelona, CÃ¡diz" required>
        <button>Buscar</button>
      </form>
      <div id="cities"></div>
      <div id="result"></div>
    </section>

    <section id="gas">
      <h1>Precios de Gasolina en EspaÃ±a</h1>
      <iframe
        class="gas-iframe"
        src="https://pakogarcia.github.io/gasolineras-espana/"
        title="Gasolineras EspaÃ±a">
      </iframe>
    </section>
  </div>

  <script>
    const apiKeyOWM = '42fb25c111df56e277d76dd2b52bdc65';

    const coastalCities = [
      'valencia','barcelona','alicante','mÃ¡laga','cÃ¡diz','huelva','gijÃ³n','a coruÃ±a','vigo',
      'bilbao','santander','san sebastiÃ¡n','palma','ibiza','mahÃ³n','las palmas','santa cruz de tenerife',
      'almerÃ­a','cartagena','murcia','castellÃ³n','tarragona','girona'
    ];

    function isCoastal(name, country){
      if(country!=='ES') return false;
      const n=name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");
      return coastalCities.some(c=>n.includes(c) || c.includes(n));
    }

    document.getElementById('weatherForm').addEventListener('submit', async e=>{
      e.preventDefault();
      const city=document.getElementById('city').value.trim();
      if(!city) return;
      document.getElementById('result').innerHTML='<p class="loading">Cargandoâ€¦</p>';
      document.getElementById('cities').innerHTML='';
      try{
        const r=await fetch(`https://api.openweathermap.org/data/2.5/find?q=${encodeURIComponent(city)}&type=like&cnt=30&appid=${apiKeyOWM}&units=metric&lang=es`);
        const data=await r.json();
        if(!data.list?.length){document.getElementById('result').innerHTML='<p>No se encontrÃ³ la ciudad.</p>';return}
        if(data.list.length===1) showWeather(data.list[0]);else showCityOptions(data.list);
      }catch{document.getElementById('result').innerHTML='<p>Error de conexiÃ³n.</p>'}
    });

    function showCityOptions(cities){
      const c=document.getElementById('cities');
      c.innerHTML='<p>Hay varias coincidencias. Elige una:</p>';
      cities.forEach(city=>{
        const btn=document.createElement('button');
        btn.textContent=`${city.name}, ${city.sys.country}`;
        btn.onclick=()=>{c.innerHTML='';showWeather(city)};
        c.appendChild(btn);
      });
    }

    async function showWeather(city){
      const {lat,lon}=city.coord;
      const wRes=await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKeyOWM}&units=metric&lang=es`);
      const w=await wRes.json();
      const coastal=isCoastal(w.name,w.sys.country);

      let html=`
        <div class="weather-card">
          <h2>${w.name}, ${w.sys.country}</h2>
          <p><strong>${w.weather[0].description}</strong></p>
          <p><strong>${w.main.temp} Â°C</strong> (sensaciÃ³n ${w.main.feels_like} Â°C)</p>
          <p>MÃ­n. ${w.main.temp_min} Â°C / MÃ¡x. ${w.main.temp_max} Â°C</p>
          <p>Humedad ${w.main.humidity} % Â· PresiÃ³n ${w.main.pressure} hPa</p>
          <p>Viento ${w.wind.speed} m/s</p>
          <img src="https://openweathermap.org/img/wn/${w.weather[0].icon}@2x.png" alt="icono">
        </div>`;

      if(coastal){
        html+=`<p class="loading">Cargando datos marÃ­timosâ€¦</p>`;
        document.getElementById('result').innerHTML=html;
        await getMarine(lat,lon);
      }else{
        document.getElementById('result').innerHTML=html;
      }
    }

    async function getMarine(lat,lon){
      try{
        const url=`https://marine-api.open-meteo.com/v1/marine?latitude=${lat}&longitude=${lon}&hourly=wave_height,wave_period,wave_direction&timezone=auto`;
        const r=await fetch(url);
        const data=await r.json();
        const h=data.hourly;
        if(!h || !h.wave_height) throw 'sin datos';

        document.querySelector('.loading')?.remove();
        document.getElementById('result').insertAdjacentHTML('beforeend',`
          <div class="marine-card">
            <h3>Condiciones MarÃ­timas</h3>
            <div class="marine-grid">
              <div class="marine-item">
                <strong class="wave-height">${(h.wave_height[0] || 0).toFixed(1)} m</strong>
                <small>Altura olas</small>
              </div>
              <div class="marine-item">
                <strong>${(h.wave_period[0] || 0).toFixed(1)} s</strong>
                <small>PerÃ­odo</small>
              </div>
            </div>
            <p><strong>DirecciÃ³n:</strong> ${Math.round(h.wave_direction[0] || 0)}Â°</p>
          </div>`);
      }catch(e){
        document.querySelector('.loading')?.remove();
        document.getElementById('result').insertAdjacentHTML('beforeend',`
          <div class="marine-card">
            <h3>Datos marÃ­timos no disponibles</h3>
            <p>Consulte fuentes oficiales para navegaciÃ³n.</p>
          </div>`);
      }
    }

    document.querySelectorAll('.nav-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const target = btn.dataset.section;
        document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        document.getElementById(target).classList.add('active');
        btn.classList.add('active');
      });
    });
  </script>
</body>
</html>