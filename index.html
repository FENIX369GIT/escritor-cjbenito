<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Escritor C J Benito ‚Äì Rutas & Servicios</title>

  <!-- Leaflet (mapa) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Routing Machine -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
  <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
  <!-- Geocoder -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder@2.4.0/dist/Control.Geocoder.css" />
  <script src="https://unpkg.com/leaflet-control-geocoder@2.4.0/dist/Control.Geocoder.min.js"></script>

  <!-- Fuentes & tema -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --bg:#000;
      --bg-soft:#111;
      --card:#0a0a0a;
      --accent:#00b4ff;
      --accent2:#0af;
      --text:#e1e1ff;
      --subtle:#6b7280;
      --radius:14px;
      --shadow:0 8px 24px rgba(0,180,255,.15);
      --font:'Inter',sans-serif;
      --mono:'JetBrains Mono',monospace;
    }
    [data-theme="light"]{
      --bg:#f2f5f9;
      --bg-soft:#fff;
      --card:#ffffff;
      --accent:#0066ff;
      --accent2:#0099ff;
      --text:#111;
      --subtle:#4b5563;
      --shadow:0 8px 24px rgba(0,102,255,.15);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      background:var(--bg);
      color:var(--text);
      font-family:var(--font);
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:2rem 1rem;
      transition:background .3s ease,color .3s ease;
    }
    .wrapper{max-width:700px;width:100%}
    .theme-toggle{
      position:absolute;
      top:1rem;
      right:1rem;
      background:none;
      border:none;
      color:var(--accent);
      font-size:1.4rem;
      cursor:pointer;
    }
    nav{
      display:flex;
      gap:.5rem;
      margin-bottom:2rem;
      flex-wrap:wrap;
    }
    nav button{
      flex:1;
      padding:.9rem;
      border:none;border-radius:var(--radius);
      background:var(--card);
      color:var(--accent);
      font-size:1rem;
      font-weight:600;
      box-shadow:var(--shadow);
      cursor:pointer;
      transition:all .3s ease;
    }
    nav button.active,nav button:hover{
      background:var(--accent);
      color:#000;
      transform:translateY(-2px);
    }
    section{display:none;animation:fadeIn .5s ease}
    section.active{display:block}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:none}}

    /* ---------- MAPA ---------- */
    #map{height:60vh;width:100%;border-radius:var(--radius);box-shadow:var(--shadow);}
    #controls{padding:10px;background:var(--card);border-radius:var(--radius);margin-bottom:.5rem;display:flex;gap:.5rem;flex-wrap:wrap}
    #controls input[type=text]{flex:1;padding:.6rem;border:none;border-radius:var(--radius)}
    #summary{padding:10px;font-size:14px;font-weight:bold;text-align:center;margin-top:.5rem}
    .iframe-section iframe{width:100%;min-height:70vh;border:none;border-radius:var(--radius);box-shadow:var(--shadow);}
    .weather-card,.marine-card{
      background:var(--card);
      border-radius:var(--radius);
      padding:1.5rem;
      box-shadow:var(--shadow);
      margin-bottom:1.5rem;
      transition:transform .2s ease;
    }
    .weather-card:hover,.marine-card:hover{transform:translateY(-4px)}
    .marine-card{border-left:4px solid var(--accent)}
    .marine-card h3{color:var(--accent);display:flex;align-items:center;gap:.5rem;font-size:1.2rem}
    .marine-card h3::before{content:"üåä";font-size:1.4em}
    .marine-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
      gap:1rem;
      margin-top:.5rem;
    }
    .marine-item{
      background:rgba(0,180,255,.1);
      padding:1rem;
      border-radius:10px;
      text-align:center;
      font-family:var(--mono);
    }
    .marine-item strong{color:var(--accent);display:block;font-size:1.2em}
    .wave-height{font-size:1.6em;color:var(--accent);font-weight:700}

    .title-btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:100%;
      margin-bottom:1.5rem;
      padding:1rem 1.5rem;
      font-size:clamp(1.5rem,2vw+1rem,2.2rem);
      font-weight:600;
      color:#000;
      background:var(--accent);
      border:none;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      text-decoration:none;
      transition:transform .2s ease;
    }
    .title-btn:hover{transform:translateY(-2px)}
    .loading{text-align:center;color:var(--subtle);margin-top:1rem}
    @media(max-width:600px){
      nav{flex-direction:column}
    }
  </style>
</head>
<body>
  <button class="theme-toggle" title="Cambiar tema">üåì</button>

  <div class="wrapper">
    <nav>
      <button class="nav-btn active" data-section="clima">Clima y estado de la mar</button>
      <button class="nav-btn" data-section="gas">Gasolineras econ√≥micas</button>
      <button class="nav-btn" data-section="tv">Noticias 24H RTVE</button>
      <button class="nav-btn" data-section="tv2">Canales TV gratuitos</button>
      <button class="nav-btn" data-section="guardias">Farmacias de guardia</button>
      <button class="nav-btn" data-section="viajes">No Solo Viajes</button>
      <!-- NUEVO apartado de rutas -->
      <button class="nav-btn" data-section="rutas">Calcula tu ruta</button>
    </nav>

    <!-- ================== CLIMA ================== -->
    <section id="clima" class="active">
      <a class="title-btn"
         href="https://www.amazon.es/Tienda-Kindle-C-J-Benito/s?rh=n%3A818936031%2Cp_27%3AC.%2BJ.%2BBenito"
         target="_blank" rel="noopener noreferrer">
        Escritor C J Benito
      </a>
      <form id="weatherForm">
        <input id="city" type="text" placeholder="Ej. Valencia, Barcelona, C√°diz" required/>
        <button>Buscar</button>
      </form>
      <div id="cities"></div>
      <div id="result"></div>
    </section>

    <!-- ================== GASOLINERA ================== -->
    <section id="gas" class="iframe-section">
      <h1>Precios de Gasolina en Espa√±a</h1>
      <iframe src="https://pakogarcia.github.io/gasolinerasespana/" title="Gasolineras Espa√±a"></iframe>
    </section>

    <!-- ================== TV EN DIRECTO ================== -->
    <section id="tv" class="iframe-section">
      <h1>RTVE 24h en Directo</h1>
      <div class="weather-card">
        <p>Pulsa el bot√≥n para ver el canal de noticias 24h de RTVE en directo.</p>
        <a href="https://www.rtve.es/play/videos/directo/informativos/24h/" target="_blank"
           style="display:inline-block;margin-top:1rem;padding:1rem 1.5rem;background:var(--accent);color:#000;border-radius:var(--radius);text-decoration:none;font-weight:600;box-shadow:var(--shadow);transition:transform .2s ease;">
          üì∫ Ver RTVE 24h en Directo
        </a>
      </div>
    </section>

    <!-- ================== tv.garden ================== -->
    <section id="tv2" class="iframe-section">
      <h1>Canales TV ‚Äì tv.garden</h1>
      <iframe src="https://tv.garden/" title="Canales de televisi√≥n gratuitos" loading="lazy" allowfullscreen></iframe>
    </section>

    <!-- ================== GUARDIAS 2025 ================== -->
    <section id="guardias" class="iframe-section">
      <h1>Farmacias de guardia ‚Äì COF Colegiados</h1>
      <iframe src="https://www.cofco.org/guardias-2025/" title="Guardias 2025" loading="lazy" allowfullscreen></iframe>
    </section>

    <!-- ================== VIAJES ================== -->
    <section id="viajes" class="iframe-section">
      <h1>Tu agencia de viajes ‚Äì No Solo Viajes</h1>
      <div class="weather-card">
        <p>Abre No Solo Viajes en una nueva pesta√±a y empieza a planificar tu viaje ideal.</p>
        <a href="https://booking.nosoloviajes.voyaverte.es" target="_blank"
           style="display:inline-block;margin-top:1rem;padding:1rem 1.5rem;background:var(--accent);color:#000;border-radius:var(--radius);text-decoration:none;font-weight:600;box-shadow:var(--shadow);transition:transform .2s ease;">
          üåç Ir a No Solo Viajes
        </a>
      </div>
    </section>

    <!-- ================== NUEVO APARTADO RUTAS ================== -->
    <section id="rutas">
      <h1>Calcula tu ruta</h1>
      <div id="controls">
        <button onclick="ubicacionActual()">Mi ubicaci√≥n actual</button>
        <input type="text" id="destino" placeholder="Escribe localidad o direcci√≥n de destino" />
        <button onclick="buscarDestino()">Buscar y trazar ruta</button>
      </div>
      <div id="map"></div>
      <div id="summary"></div>
    </section>
  </div>

  <script>
    /* ------------------ TEMA ------------------ */
    const toggleBtn = document.querySelector('.theme-toggle');
    const html = document.documentElement;
    const saved = localStorage.getItem('theme') || 'dark';
    html.setAttribute('data-theme', saved);
    toggleBtn.addEventListener('click', () => {
      const current = html.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
    });

    /* ------------------ NAVEGACI√ìN ------------------ */
    document.querySelectorAll('.nav-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const target = btn.dataset.section;
        document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        document.getElementById(target).classList.add('active');
        btn.classList.add('active');
      });
    });

    /* ---------- CLIMA ---------- */
    const apiKeyOWM = '42fb25c111df56e277d76dd2b52bdc65';
    const coastalCities = ['valencia','barcelona','alicante','m√°laga','c√°diz','huelva','gij√≥n','acoru√±a','vigo','bilbao','santander','san sebasti√°n','palma','ibiza','mah√≥n','las palmas','santa cruz de tenerife','almer√≠a','cartagena','murcia','castell√≥n','tarragona','girona'];

    function isCoastal(name, country){
      if(country!=='ES') return false;
      const n=name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");
      return coastalCities.some(c=>n.includes(c) || c.includes(n));
    }

    document.getElementById('weatherForm').addEventListener('submit', async e=>{
      e.preventDefault();
      const city=document.getElementById('city').value.trim();
      if(!city) return;
      document.getElementById('result').innerHTML='<p class="loading">Cargando‚Ä¶</p>';
      document.getElementById('cities').innerHTML='';
      try{
        const r=await fetch(`https://api.openweathermap.org/data/2.5/find?q=${encodeURIComponent(city)}&type=like&cnt=30&appid=${apiKeyOWM}&units=metric&lang=es`);
        const data=await r.json();
        if(!data.list?.length){document.getElementById('result').innerHTML='<p>No se encontr√≥ la ciudad.</p>';return}
        if(data.list.length===1) showWeather(data.list[0]); else showCityOptions(data.list);
      }catch{document.getElementById('result').innerHTML='<p>Error de conexi√≥n.</p>'}
    });

    function showCityOptions(cities){
      const c=document.getElementById('cities');
      c.innerHTML='<p>Hay varias coincidencias. Elige una:</p>';
      cities.forEach(city=>{
        const btn=document.createElement('button');
        btn.textContent=`${city.name}, ${city.sys.country}`;
        btn.onclick=()=>{c.innerHTML='';showWeather(city)};
        c.appendChild(btn);
      });
    }

    async function showWeather(city){
      const {lat,lon}=city.coord;
      const wRes=await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKeyOWM}&units=metric&lang=es`);
      const w=await wRes.json();
      const coastal=isCoastal(w.name,w.sys.country);

      let html=`
        <div class="weather-card">
          <h2>${w.name}, ${w.sys.country}</h2>
          <p><strong>${w.weather[0].description}</strong></p>
          <p><strong>${w.main.temp} ¬∞C</strong> (sensaci√≥n ${w.main.feels_like} ¬∞C)</p>
          <p>M√≠n. ${w.main.temp_min} ¬∞C / M√°x. ${w.main.temp_max} ¬∞C</p>
          <p>Humedad ${w.main.humidity} % ¬∑ Presi√≥n ${w.main.pressure} hPa</p>
          <p>Viento ${w.wind.speed} m/s</p>
          <img src="https://openweathermap.org/img/wn/${w.weather[0].icon}@2x.png" alt="icono del clima">
        </div>`;

      if(coastal){
        html+=`<p class="loading">Cargando datos mar√≠timos‚Ä¶</p>`;
        document.getElementById('result').innerHTML=html;
        await getMarine(lat,lon);
      }else{
        document.getElementById('result').innerHTML=html;
      }
    }

    async function getMarine(lat,lon){
      try{
        const url=`https://marine-api.open-meteo.com/v1/marine?latitude=${lat}&longitude=${lon}&hourly=wave_height,wave_period,wave_direction&timezone=auto`;
        const r=await fetch(url);
        const data=await r.json();
        const h=data.hourly;
        if(!h || !h.wave_height) throw 'sin datos';

        document.querySelector('.loading')?.remove();
        document.getElementById('result').insertAdjacentHTML('beforeend',`
          <div class="marine-card">
            <h3>Condiciones Mar√≠timas</h3>
            <div class="marine-grid">
              <div class="marine-item">
                <strong class="wave-height">${(h.wave_height[0] || 0).toFixed(1)} m</strong>
                <small>Altura olas</small>
              </div>
              <div class="marine-item">
                <strong>${(h.wave_period[0] || 0).toFixed(1)} s</strong>
                <small>Per√≠odo</small>
              </div>
            </div>
            <p><strong>Direcci√≥n:</strong> ${Math.round(h.wave_direction[0] || 0)}¬∞</p>
          </div>`);
      }catch(e){
        document.querySelector('.loading')?.remove();
        document.getElementById('result').insertAdjacentHTML('beforeend',`
          <div class="marine-card">
            <h3>Datos mar√≠timos no disponibles</h3>
            <p>Consulte fuentes oficiales para navegaci√≥n.</p>
          </div>`);
      }
    }

    /* ---------- MAPA / RUTAS ---------- */
    const map = L.map('map').setView([40,-4],6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
      attribution:'¬© OpenStreetMap contributors'
    }).addTo(map);

    let routeControl=null, markerOrigen=null, markerDestino=null, posOrigen=null;

    function limpiar(){
      if(routeControl) map.removeControl(routeControl);
      if(markerOrigen) map.removeLayer(markerOrigen);
      if(markerDestino) map.removeLayer(markerDestino);
      document.getElementById('summary').textContent='';
    }

    function ubicacionActual(){
      limpiar();
      if(!navigator.geolocation){alert('Geolocalizaci√≥n no soportada');return}
      navigator.geolocation.getCurrentPosition(pos=>{
        posOrigen=[pos.coords.latitude,pos.coords.longitude];
        markerOrigen=L.marker(posOrigen).addTo(map).bindPopup('Estoy aqu√≠').openPopup();
        map.setView(posOrigen,14);
      },err=>alert(err.message));
    }

    function buscarDestino(){
      const texto=document.getElementById('destino').value.trim();
      if(!texto){alert('Escribe un destino');return}
      if(!posOrigen){alert('Primero pulsa ‚ÄúMi ubicaci√≥n actual‚Äù');return}

      limpiar();
      markerOrigen=L.marker(posOrigen).addTo(map).bindPopup('Origen');

      fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(texto)}`)
        .then(r=>r.json())
        .then(data=>{
          if(!data.length){alert('Destino no encontrado');return}
          const dest=[parseFloat(data[0].lat),parseFloat(data[0].lon)];
          markerDestino=L.marker(dest).addTo(map).bindPopup(texto).openPopup();

          routeControl = L.Routing.control({
          waypoints: [L.latLng(posOrigen), L.latLng(dest)],
          routeWhileDragging: true,
          createMarker: () => null,
          geocoder: L.Control.Geocoder.nominatim(),
         lineOptions: { styles: [{ color: 'blue', weight: 5 }] },
         show: false // <-- esto lo oculta
          }).addTo(map);

          routeControl.on('routesfound',e=>{
            const r=e.routes[0].summary;
            document.getElementById('summary').textContent=
              `Distancia: ${(r.totalDistance/1000).toFixed(2)} km ‚Äì Tiempo: ${Math.round(r.totalTime/60)} min`;
          });
        })
        .catch(e=>alert('Error al buscar destino: '+e));
    }

    /* --- Fix: Redimensionar mapa cuando se muestra la secci√≥n de rutas --- */
document.querySelectorAll('.nav-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    if (btn.dataset.section === 'rutas') {
      setTimeout(() => {
        map.invalidateSize();
      }, 100); // peque√±o retraso para que se renderice el contenedor
    }
  });
});
  </script>
</body>
</html>